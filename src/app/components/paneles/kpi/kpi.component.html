<div class="kpi-contenedor">

  <!-- ================= CONTEXTO / FILTRO ================= -->
  <div class="kpi-contenedor-filtro">
    <mat-card class="mat-card-custom mat-elevation-z4">
      <div class="filtro-header">
        <span class="filtro-texto">
          <strong>Filtro de datos:</strong>
          {{ range.start | date : "dd/MM/yyyy HH:mm:ss" }} -
          {{ range.end | date : "dd/MM/yyyy HH:mm:ss" }} | Activo:
          {{ selectedAsset.code }}
        </span>

        <div class="filtro-botones">
          <mat-spinner *ngIf="cargando" diameter="30"></mat-spinner>

          <button mat-icon-button matTooltip="Recargar" (click)="recargar()">
            <mat-icon>refresh</mat-icon>
          </button>

          <button mat-icon-button matTooltip="Aplicar filtros" (click)="openDialog()">
            <mat-icon>filter_list</mat-icon>
          </button>
        </div>
      </div>
    </mat-card>
  </div>

  <div class="kpi-grid">

    <!-- DISTRIBUCIÓN DE ESTADOS -->
    <mat-card class="card">
      <h3>Distribución de Tareas</h3>
      <app-kpi-grafico-torta
        [data]="estadosTorta">
      </app-kpi-grafico-torta>
    </mat-card>

    <!-- TASA DE UTILIZACIÓN -->
    <mat-card class="card radial-chart">
      <h3>Tasa de Utilización (%)</h3>
      <app-kpi-grafico-radial-bar
        label="Utilización promedio"
        [valor]="this.promediosRadial.tasa_de_utilizacion">
      </app-kpi-grafico-radial-bar>
    </mat-card>

    <!-- ENERGÍA NO PRODUCTIVA -->
    <mat-card class="card radial-chart">
      <h3>Energía No Productiva de la Máquina (%)</h3>
      <app-kpi-grafico-radial-bar
        label="Utilización promedio"
        [valor]="this.promediosRadial.energia_no_productiva">
      </app-kpi-grafico-radial-bar>
    </mat-card>

    <!-- KPIs OPERATIVOS -->
    <mat-card class="card kpi-contadores kpi-split">

      <mat-card class="kpi-subcard superior">
        <h4 class="kpi-subtitulo">Mantenimiento y Confiabilidad</h4>

        <div class="kpi-row">
          <div class="totalizador-item">
            <div class="titulo-totalizador">Hs Desde el Último<br>Mantenimiento</div>
            <div class="circulo-valor">
              {{ this.mantenimiento.tiempo_ultimo_mantenimiento }} <span class="unidad">h</span>
            </div>
          </div>
        </div>

      </mat-card>

      <mat-card class="kpi-subcard inferior">
        <div class="kpi-grid-inferior">
          <div class="totalizador-item">
            <div class="titulo-totalizador">Consumo Espec.<br>de Energía</div>
            <div class="circulo-valor">
              {{ this.mantenimiento.consumo_esp_energia }}<br>
              <span class="unidad">kWh/pieza</span>
            </div>
          </div>

          <div class="totalizador-item">
            <div class="titulo-totalizador">Tiempo de Ciclo<br>Promedio</div>
            <div class="circulo-valor">
              {{ this.mantenimiento.tiempo_ciclo_promedio }} <span class="unidad">s/pieza</span>
            </div>
          </div>
        </div>
      </mat-card>

    </mat-card>

    <!-- ENERGÍA TOTAL -->
    <mat-card class="card doble">
      <h3>Energía total consumida (kWh)</h3>
      <div class="chart-wrapper">
        <app-kpi-grafico-barra-apilado
          [data]="energiaPorTurnoBarra">
        </app-kpi-grafico-barra-apilado>
      </div>
    </mat-card>

    <!--  PRODUCCIÓN  -->
    <mat-card class="card doble">
      <h3>Piezas producidas por hora</h3>
      <div class="chart-wrapper" appBlockWheelScroll>
        <app-kpi-grafico-linea
          [data]="piezasPorHoraLinea">
        </app-kpi-grafico-linea>
      </div>
    </mat-card>

    <!-- TIEMPO VS ESTADO -->
    <mat-card class="card cuadruple">
      <h3>Tiempo vs Estado</h3>
      <div class="gantt-wrapper" appBlockWheelScroll>
        <app-kpi-grafico-gantt
          [data]="estadosGantt">
        </app-kpi-grafico-gantt>
      </div>
    </mat-card>

    <!--  ACTOS INSEGUROS
    <mat-card class="card doble">
      <h3>Actos inseguros</h3>
      <div class="chart-wrapper">
        <app-kpi-grafico-barra
          [data]="actosInsegurosBarra">
        </app-kpi-grafico-barra>
      </div>
    </mat-card>
    -->

  </div>
</div>

