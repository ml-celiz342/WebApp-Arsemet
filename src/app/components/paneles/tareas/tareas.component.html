<h2 class="titulo-pagina">Tareas</h2>
<div class="tareas-contenedor">
  <div class="tareas-contenedor-filtro">
    <mat-card class="mat-card-custom mat-elevation-z4">
      <div class="filtro-header">
        <span class="filtro-texto">
          <strong>Filtro de datos:</strong>
          {{ range.start | date : "dd/MM/yyyy HH:mm:ss" }} -
          {{ range.end | date : "dd/MM/yyyy HH:mm:ss" }}
        </span>

        <!-- FILTROS -->
        <div class="filtro-botones">

          <!-- Spinner -->
          <mat-spinner *ngIf="cargando"></mat-spinner>

          <!-- Cargar csv -->
          <!-- *ngIf="authService.hasPermission('tasks', 'write')" -->
          <button
            mat-icon-button
            (click)="cargarCsv()"

            matTooltip="Cargar archivo .CSV"
          >
            <mat-icon class="agregar-icono">add_circle</mat-icon>
          </button>

          <!-- Boton recargar -->
          <button mat-icon-button (click)="recargar()" matTooltip="Recargar tareas">
            <mat-icon>refresh</mat-icon>
          </button>

          <!-- Filtro por fecha -->
          <button mat-icon-button matTooltip="Aplicar filtros" (click)="openDialog()">
            <mat-icon>filter_list</mat-icon>
          </button>

        </div>

      </div>
    </mat-card>
  </div>

  <!-- Tareas -->
  <div class="contenedor-tareas">
    <mat-card class="mat-card-custom mat-elevation-z4">
      <div class="tareas-contenedor-element">
        <div class="table-wrapper scroll-x">
          <table mat-table [dataSource]="dataSourceTasks" matSort class="table table-tareas">

            <!-- COLUMNA: Activo -->
            <ng-container matColumnDef="codigo_activo">
              <th mat-header-cell *matHeaderCellDef>Activo</th>
              <td mat-cell *matCellDef="let element">
                {{ getAssetCode(element.id_asset) }}
              </td>
            </ng-container>

            <!-- COLUMNA: Codigo Articulo -->
            <ng-container matColumnDef="codigo_articulo">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Articulo</th>
              <td mat-cell *matCellDef="let element">
                {{ element.article_code }}
              </td>
            </ng-container>

            <!-- COLUMNA: Fin -->
            <ng-container matColumnDef="ciclo_fecha_fin">
              <th mat-header-cell *matHeaderCellDef>Fecha Fin</th>
              <td mat-cell *matCellDef="let element">
                {{ element.cycle_end | date:'dd/MM/yyyy HH:mm:ss' }}
              </td>
            </ng-container>

            <!-- COLUMNA: Inicio Estimado -->
            <ng-container matColumnDef="ciclo_fecha_inicio_est">
              <th mat-header-cell *matHeaderCellDef>Fecha Inicio Estimado</th>
              <td mat-cell *matCellDef="let element">
                {{ element.cycle_start_est | date:'dd/MM/yyyy HH:mm:ss' }}
              </td>
            </ng-container>

            <!-- COLUMNA: Inicio Medido -->
            <ng-container matColumnDef="ciclo_fecha_inicio_medida">
              <th mat-header-cell *matHeaderCellDef>Fecha Inicio Medido</th>
              <td mat-cell *matCellDef="let element">
                <!-- Completar campo mas adelante -->
              </td>
            </ng-container>

            <!-- COLUMNA: Cantidad Prog -->
            <ng-container matColumnDef="pza_cant_prog">
              <th mat-header-cell *matHeaderCellDef>Cant Programadas</th>
              <td mat-cell *matCellDef="let element">
                {{ element.planned_qty }}
              </td>
            </ng-container>

            <!-- COLUMNA: Cantidad Buenas -->
            <ng-container matColumnDef="pza_cant_buenas">
              <th mat-header-cell *matHeaderCellDef>Cant Buena</th>
              <td mat-cell *matCellDef="let element">
                {{ element.good_qty }}
              </td>
            </ng-container>

            <!-- COLUMNA: Cantidad Malas -->
            <ng-container matColumnDef="pza_cant_malas">
              <th mat-header-cell *matHeaderCellDef>Cant Mala</th>
              <td mat-cell *matCellDef="let element">
                {{ element.bad_qty }}
              </td>
            </ng-container>

            <!-- COLUMNA: Cantidad Usuario -->
            <ng-container matColumnDef="pza_cant_usuario">
              <th mat-header-cell *matHeaderCellDef>Cant Ejecutadas</th>
              <td mat-cell *matCellDef="let element">
                {{ element.user_qty }}
              </td>
            </ng-container>

            <!-- COLUMNA: Detalle -->
            <ng-container matColumnDef="detalle">
              <th mat-header-cell *matHeaderCellDef>Detalle</th>
              <td mat-cell *matCellDef="let element">
                  <button mat-icon-button (click)="onDetalleClick(element)"
                    [disabled]="element.low_date"
                    *ngIf=" (authService.hasPermission('roles','read') &&authService.hasPermission('modules','read'))"
                    matTooltip="Ver detalle"
                    >
                    <mat-icon class="description-icon">description</mat-icon>
                  </button>
              </td>
            </ng-container>

            <tr
              mat-header-row
              *matHeaderRowDef="displayedColumnsTasks"
              class="table-header"
            ></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: displayedColumnsTasks"
            ></tr>
          </table>
        </div>
        <mat-paginator
          #paginatorTasks
          [pageSize]="10"
          [pageSizeOptions]="[10, 20]"
          showFirstLastButtons
          class="table-paginator"
        ></mat-paginator>
      </div>
    </mat-card>
  </div>

</div>
