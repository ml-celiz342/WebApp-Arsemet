<h2 class="titulo-pagina">Usuarios</h2>
<div class="usuarios-contenedor">
  <div class="usuarios-contenedor-filtro">
    <mat-card class="mat-card-custom mat-elevation-z4">
      <div class="filtro-header">
        <span class="filtro-texto">
          <strong>Filtro de estados:</strong>
          <!-- Checkbox Activos/Inactivos -->
          <mat-checkbox
            class="example-margin"
            (change)="toggleChecked('activos')"
            [checked]="isSelected('activos')"
          >
            Habilitados</mat-checkbox
          >
          <mat-checkbox
            class="example-margin"
            (change)="toggleChecked('inactivos')"
            [checked]="isSelected('inactivos')"
            >Deshabilitados</mat-checkbox
          >
        </span>
        <div class="filtro-botones">
          <mat-spinner *ngIf="cargando"></mat-spinner>
          <button mat-icon-button (click)="recargar()" matTooltip="Recargar usuarios">
            <mat-icon>refresh</mat-icon>
          </button>
          <button mat-icon-button (click)="agregarEditarUsuario()"
           *ngIf=" (authService.hasPermission('users','write') && authService.hasPermission('roles','read'))"
            matTooltip="Agregar usuario"
           >
            <mat-icon class="agregar-icono">add_circle</mat-icon>
          </button>
        </div>
      </div>
    </mat-card>
  </div>
  <div class="usuarios-contenedor-tabla">
    <mat-card class="mat-card-custom mat-elevation-z4">
      <div class="usuarios-contenedor-element">
        <div class="table-wrapper">
          <table mat-table [dataSource]="dataSourceUsuarios" class="table">
            <!-- Nombre -->
            <ng-container matColumnDef="nombre">
              <th mat-header-cell *matHeaderCellDef>Nombre</th>
              <td mat-cell *matCellDef="let element">
                {{ element.nombre }}
              </td>
            </ng-container>

            <!-- Apellido -->
            <ng-container matColumnDef="apellido">
              <th mat-header-cell *matHeaderCellDef>Apellido</th>
              <td mat-cell *matCellDef="let element">
                {{ element.apellido }}
              </td>
            </ng-container>

            <!-- Email -->
            <ng-container matColumnDef="email">
              <th mat-header-cell *matHeaderCellDef>Email</th>
              <td mat-cell *matCellDef="let element">
                {{ element.email }}
              </td>
            </ng-container>

            <!-- Rol -->
            <ng-container matColumnDef="rol">
              <th mat-header-cell *matHeaderCellDef>Rol</th>
              <td mat-cell *matCellDef="let element">
                {{ element.rol }}
              </td>
            </ng-container>

            <!-- Sesiones -->
            <ng-container matColumnDef="sesiones">
              <th mat-header-cell *matHeaderCellDef>Sesiones</th>
              <td mat-cell *matCellDef="let element">
                {{ element.sesiones }}
              </td>
            </ng-container>

            <!-- registration -->
            <ng-container matColumnDef="fecha_alta">
              <th mat-header-cell *matHeaderCellDef>Registro</th>
              <td mat-cell *matCellDef="let element">
                {{ element.fecha_alta | date : "dd/MM/yyyy HH:mm:ss" }}
              </td>
            </ng-container>

            <!-- lowdate -->
            <ng-container matColumnDef="fecha_baja">
              <th mat-header-cell *matHeaderCellDef>Fecha de baja</th>
              <td mat-cell *matCellDef="let element">
                {{ element.fecha_baja | date : "dd/MM/yyyy HH:mm:ss" }}
              </td>
            </ng-container>

            <!-- Acciones -->
            <ng-container matColumnDef="acciones">
              <th mat-header-cell *matHeaderCellDef>Acciones</th>
              <td mat-cell *matCellDef="let element">
                <div class="evidencia-cell">
                  <!-- Bot贸n para Editar -->
                  <button
                    mat-icon-button
                    (click)="agregarEditarUsuario(element)"
                    [disabled]="element.fecha_baja"
                    *ngIf=" (authService.hasPermission('users','edit') && authService.hasPermission('roles','read'))"
                    matTooltip="Editar usuario"
                    >
                    <mat-icon
                      [ngClass]="{ 'editar-icono': !element.fecha_baja }"
                      >edit</mat-icon
                    >
                  </button>
                  <!-- Bot贸n para renovar clave -->
                  <button
                    mat-icon-button
                    (click)="renovarContraseneaUsuario(element)"
                    [disabled]="element.fecha_baja"
                    *ngIf=" (authService.hasPermission('users','edit'))"
                     matTooltip="Generar clave temporal"
                  >
                    <mat-icon
                      [ngClass]="{ 'renovar-icono': !element.fecha_baja }"
                      >key</mat-icon
                    >
                  </button>
                  <!-- Bot贸n para cerrar sesiones activas -->
                  <button
                    mat-icon-button
                    (click)="cerrarSesionesUsuario(element)"
                    [disabled]="element.fecha_baja || element.sesiones==0"
                    *ngIf=" (authService.hasPermission('oauth','write'))"
                    matTooltip="Cerrar sesiones activas"
                  >
                    <mat-icon
                      [ngClass]="{ 'cerrarsesion-icono': (!element.fecha_baja || element.sesiones!=0) }"
                      >logout</mat-icon
                    >
                  </button>
                  <!-- Bot贸n para Eliminar -->
                  <button
                    mat-icon-button
                    (click)="eliminarUsuario(element)"
                    [disabled]="element.fecha_baja"
                     *ngIf="(authService.hasPermission('users','edit'))"
                     matTooltip="Deshabilitar usuario"
                  >
                    <mat-icon
                      [ngClass]="{ 'eliminar-icono': !element.fecha_baja }"
                      >delete</mat-icon
                    >
                  </button>
                </div>
              </td>
            </ng-container>

            <tr
              mat-header-row
              *matHeaderRowDef="displayedColumnsUsuarios"
              class="table-header"
            ></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: displayedColumnsUsuarios"
            ></tr>
          </table>
        </div>
        <mat-paginator
          #paginatorUsuarios
          [pageSizeOptions]="[10, 20]"
          showFirstLastButtons
          class="table-paginator"
        ></mat-paginator>
      </div>
    </mat-card>
  </div>
</div>
