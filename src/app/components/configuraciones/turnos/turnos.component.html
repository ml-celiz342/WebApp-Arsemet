<h2 class="titulo-pagina">Turnos</h2>
<mat-tab-group
  mat-stretch-tabs="false"
  mat-align-tabs="center"
  [selectedIndex]="selectedPage.value"
  (selectedIndexChange)="selectPage($event)"
>
  <!-- TURNOS -->
  <mat-tab label="Turnos">
    <div class="turnos-contenedor">

      <!-- FILTRO -->
      <div class="turnos-contenedor-filtro">
        <mat-card class="mat-card-custom mat-elevation-z4">
          <div class="filtro-header">
            <span class="filtro-texto">
              <strong>Filtro de estados:</strong>
              <!-- Checkbox Activos/Inactivos -->
              <mat-checkbox
                class="example-margin"
                (change)="toggleChecked('activos')"
                [checked]="isSelected('activos')"
              >
                Habilitados</mat-checkbox
              >
              <mat-checkbox
                class="example-margin"
                (change)="toggleChecked('inactivos')"
                [checked]="isSelected('inactivos')"
                >Deshabilitados</mat-checkbox
              >
            </span>
            <div class="filtro-botones">
              <mat-spinner *ngIf="cargando"></mat-spinner>
              <button mat-icon-button (click)="recargar()" matTooltip="Recargar turnos">
                <mat-icon>refresh</mat-icon>
              </button>
              <button mat-icon-button
                (click)="agregarEditarTurno()"
                *ngIf=" (authService.hasPermission('shifts','edit'))"
                matTooltip="Agregar turnos"
              >
                <mat-icon class="agregar-icono">add_circle</mat-icon>
              </button>
            </div>
          </div>
        </mat-card>
      </div>

      <!-- TABLA -->
      <div class="turnos-contenedor-tabla">
        <mat-card class="mat-card-custom mat-elevation-z4">
          <div class="turnos-contenedor-element">
            <div class="table-wrapper">
              <table mat-table [dataSource]="dataSourceTurnos" class="table">

                <!-- Nombre -->
                <ng-container matColumnDef="nombre">
                  <th mat-header-cell *matHeaderCellDef>Nombre</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.name }}
                  </td>
                </ng-container>

                <!-- Inicio -->
                <ng-container matColumnDef="inicio">
                  <th mat-header-cell *matHeaderCellDef>Inicio</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.start | slice:11:16 }} hs
                  </td>
                </ng-container>

                <!-- Fin -->
                <ng-container matColumnDef="fin">
                  <th mat-header-cell *matHeaderCellDef>Fin</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.end | slice:11:16 }} hs
                  </td>
                </ng-container>

                <!-- ----- DIAS DE LA SEMANA ----- -->
                <!-- Lunes -->
                <ng-container matColumnDef="mon">
                  <th mat-header-cell *matHeaderCellDef>L</th>
                  <td mat-cell *matCellDef="let e" class="dia-cell">
                    <mat-checkbox [checked]="e.monday" disabled></mat-checkbox>
                  </td>
                </ng-container>

                <!-- Martes -->
                <ng-container matColumnDef="tue">
                  <th mat-header-cell *matHeaderCellDef>M</th>
                  <td mat-cell *matCellDef="let e" class="dia-cell">
                    <mat-checkbox [checked]="e.tuesday" disabled></mat-checkbox>
                  </td>
                </ng-container>

                <!-- Miércoles -->
                <ng-container matColumnDef="wed">
                  <th mat-header-cell *matHeaderCellDef>M</th>
                  <td mat-cell *matCellDef="let e" class="dia-cell">
                    <mat-checkbox [checked]="e.wednesday" disabled></mat-checkbox>
                  </td>
                </ng-container>

                <!-- Jueves -->
                <ng-container matColumnDef="thu">
                  <th mat-header-cell *matHeaderCellDef>J</th>
                  <td mat-cell *matCellDef="let e" class="dia-cell">
                    <mat-checkbox [checked]="e.thursday" disabled></mat-checkbox>
                  </td>
                </ng-container>

                <!-- Viernes -->
                <ng-container matColumnDef="fri">
                  <th mat-header-cell *matHeaderCellDef>V</th>
                  <td mat-cell *matCellDef="let e" class="dia-cell">
                    <mat-checkbox [checked]="e.friday" disabled></mat-checkbox>
                  </td>
                </ng-container>

                <!-- Sábado -->
                <ng-container matColumnDef="sat">
                  <th mat-header-cell *matHeaderCellDef>S</th>
                  <td mat-cell *matCellDef="let e" class="dia-cell">
                    <mat-checkbox [checked]="e.saturday" disabled></mat-checkbox>
                  </td>
                </ng-container>

                <!-- Domingo -->
                <ng-container matColumnDef="sun">
                  <th mat-header-cell *matHeaderCellDef>D</th>
                  <td mat-cell *matCellDef="let e" class="dia-cell">
                    <mat-checkbox [checked]="e.sunday" disabled></mat-checkbox>
                  </td>
                </ng-container>

                <!-- Descansos -->
                <ng-container matColumnDef="descansos">
                  <th mat-header-cell *matHeaderCellDef>Descansos</th>
                  <td mat-cell *matCellDef="let element">
                    <div class="acciones-cell">

                      <!-- Botón para Historico -->
                      <button mat-icon-button
                        (click)="historialTurnos(element)"
                        *ngIf=" (authService.hasPermission('shifts','read'))"
                        matTooltip="Ver historial"
                      >
                        <mat-icon  >history</mat-icon>
                      </button>

                    </div>
                  </td>
                </ng-container>

                <!-- Acciones -->
                <ng-container matColumnDef="acciones">
                  <th mat-header-cell *matHeaderCellDef>Acciones</th>
                  <td mat-cell *matCellDef="let element">
                    <div class="evidencia-cell">

                      <!-- Editar -->
                      <button
                        mat-icon-button
                        (click)="agregarEditarTurno(element)"
                        *ngIf=" (authService.hasPermission('shifts','edit'))"
                        matTooltip="Editar turno"
                      >
                        <mat-icon class="editar-icono">edit</mat-icon>
                      </button>

                      <!-- Eliminar -->
                      <button
                        mat-icon-button
                        (click)="eliminarTurno(element)"
                        [disabled]="element.fecha_baja"
                        *ngIf="(authService.hasPermission('shifts','edit'))"
                        matTooltip="Deshabilitar turno"
                      >
                        <mat-icon class="eliminar-icono">delete</mat-icon>
                      </button>
                    </div>
                  </td>
                </ng-container>

                <tr
                  mat-header-row
                  *matHeaderRowDef="displayedColumnsTurnos"
                  class="table-header"
                ></tr>
                <tr
                  mat-row
                  *matRowDef="let row; columns: displayedColumnsTurnos"
                ></tr>

              </table>
            </div>
          </div>
        </mat-card>
      </div>

    </div>
  </mat-tab>

  <!-- TURNOS - ACTIVOS -->
  <mat-tab label="Turnos-Activos">
    <div class="turnos-activos-contenedor">

      <!-- FILTRO -->
      <div class="turnos-activos-contenedor-filtro">
        <mat-card class="mat-card-custom mat-elevation-z4">
          <div class="filtro-header">
            <span class="filtro-texto">
              <strong>Estados de vínculos:</strong>
              <!-- Checkbox Activos/Inactivos -->
              <mat-checkbox
                class="example-margin"
                (change)="toggleChecked('activos')"
                [checked]="isSelected('activos')"
              >
                Habilitados</mat-checkbox
              >
              <mat-checkbox
                class="example-margin"
                (change)="toggleChecked('inactivos')"
                [checked]="isSelected('inactivos')"
                >Deshabilitados</mat-checkbox
              >
            </span>
            <div class="filtro-botones">
              <mat-spinner *ngIf="cargando"></mat-spinner>
              <button mat-icon-button (click)="recargar()" matTooltip="Recargar vínculos">
                <mat-icon>refresh</mat-icon>
              </button>

              <button mat-icon-button (click)="agregarVinculo()"
              *ngIf="(authService.hasPermission('shifts','read') && authService.hasPermission('assets','read') && authService.hasPermission('shifts','write'))"
              matTooltip="Editar vínculo"
              >
                <mat-icon class="agregar-icono">add_link</mat-icon>
              </button>
            </div>
          </div>
        </mat-card>
      </div>

      <!-- TABLA -->
      <div class="turnos-activos-contenedor-tabla">
        <mat-card class="mat-card-custom mat-elevation-z4">
          <div class="turnos-activos-contenedor-element">
            <div class="table-wrapper">
              <table
                mat-table
                [dataSource]="dataSourceTurnosActivos"
                class="table"
              >
                <!-- Nombre de turno -->
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef>Turno</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.name }}
                  </td>
                </ng-container>

                <!-- Codigo de activo -->
                <ng-container matColumnDef="code">
                  <th mat-header-cell *matHeaderCellDef>Activo</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.code }}
                  </td>
                </ng-container>

                <!-- Fecha Alta -->
                <ng-container matColumnDef="fecha_alta">
                  <th mat-header-cell *matHeaderCellDef>Vinculación</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.registration_date | date : "dd/MM/yyyy HH:mm:ss" }}
                  </td>
                </ng-container>

                <!-- Fecha Baja -->
                <ng-container matColumnDef="fecha_baja">
                  <th mat-header-cell *matHeaderCellDef>Desvinculación</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.low_date | date : "dd/MM/yyyy HH:mm:ss" }}
                  </td>
                </ng-container>

                <!-- Acciones -->
                <ng-container matColumnDef="acciones">
                  <th mat-header-cell *matHeaderCellDef>Acciones</th>
                  <td mat-cell *matCellDef="let element">
                    <div class="acciones-cell">
                      <!-- Eliminar -->
                      <button
                        mat-icon-button
                        (click)="eliminarVinculo(element)"
                        [disabled]="element.low_date"
                        *ngIf="(authService.hasPermission('devices','edit'))"
                        matTooltip="Deshabilitar vínculo"
                        >
                        <mat-icon
                          [ngClass]="{ 'eliminar-icono': !element.low_date }"
                          >link_off</mat-icon
                        >
                      </button>
                    </div>
                  </td>
                </ng-container>

                <tr
                  mat-header-row
                  *matHeaderRowDef="displayedColumnsTurnosActivos"
                  class="table-header"
                ></tr>
                <tr
                  mat-row
                  *matRowDef="
                    let row;
                    columns: displayedColumnsTurnosActivos
                  "
                ></tr>
              </table>
            </div>
            <mat-paginator
              #paginatorDispositivoAnalitica
              [pageSizeOptions]="[10, 20]"
              showFirstLastButtons
              class="table-paginator"
            ></mat-paginator>
          </div>
        </mat-card>
      </div>

    </div>
  </mat-tab>
</mat-tab-group>
