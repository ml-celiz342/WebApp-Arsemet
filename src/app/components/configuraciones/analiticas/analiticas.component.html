<h2 class="titulo-pagina">Analíticas</h2>
<mat-tab-group
  mat-stretch-tabs="false"
  mat-align-tabs="center"
  [selectedIndex]="selectedPage.value"
  (selectedIndexChange)="selectPage($event)"
>
  <mat-tab label="Analíticas">
    <div class="analiticas-contenedor">
      <div class="analiticas-contenedor-filtro">
        <mat-card class="mat-card-custom mat-elevation-z4">
          <div class="filtro-header">
            <span class="filtro-texto">
              <strong>Filtro de estados:</strong>
              <!-- Checkbox Activos/Inactivos -->
              <mat-checkbox
                class="example-margin"
                (change)="toggleChecked('activos')"
                [checked]="isSelected('activos')"
              >
                Habilitados</mat-checkbox
              >
              <mat-checkbox
                class="example-margin"
                (change)="toggleChecked('inactivos')"
                [checked]="isSelected('inactivos')"
                >Deshabilitados</mat-checkbox
              >
            </span>
            <div class="filtro-botones">
              <mat-spinner *ngIf="cargando"></mat-spinner>
              <button mat-icon-button (click)="recargar()" matTooltip="Recargar analíticas">
                <mat-icon>refresh</mat-icon>
              </button>
              <button mat-icon-button (click)="agregarEditarAnaliticas()"
              *ngIf=" (authService.hasPermission('analytics','write'))"
              matTooltip="Agregar analítica"
              >
                <mat-icon class="agregar-icono">add_circle</mat-icon>
              </button>
            </div>
          </div>
        </mat-card>
      </div>
      <div class="analiticas-contenedor-tabla">
        <mat-card class="mat-card-custom mat-elevation-z4">
          <div class="analiticas-contenedor-element">
            <div class="table-wrapper">
              <table mat-table [dataSource]="dataSourceAnalytics" class="table">
                <!-- Nombre -->
                <ng-container matColumnDef="nombre">
                  <th mat-header-cell *matHeaderCellDef>Nombre</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.nombre }}
                  </td>
                </ng-container>

                <!-- Comentarios -->
                <ng-container matColumnDef="descripcion">
                  <th mat-header-cell *matHeaderCellDef>Descripción</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.comentario }}
                  </td>
                </ng-container>

                <!-- Pausa -->
                <ng-container matColumnDef="pausa">
                  <th mat-header-cell *matHeaderCellDef>Pausa</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.pausa }}
                  </td>
                </ng-container>

                <!-- registration -->
                <ng-container matColumnDef="registro">
                  <th mat-header-cell *matHeaderCellDef>Registro</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.fecha_alta | date : "dd/MM/yyyy HH:mm:ss" }}
                  </td>
                </ng-container>

                <!-- lowdate -->
                <ng-container matColumnDef="lowdate">
                  <th mat-header-cell *matHeaderCellDef>Fecha de baja</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.fecha_baja | date : "dd/MM/yyyy HH:mm:ss" }}
                  </td>
                </ng-container>

                <!-- configuracion -->
                <ng-container matColumnDef="configuracion">
                  <th mat-header-cell *matHeaderCellDef>Configuracion</th>
                  <td mat-cell *matCellDef="let element">
                    <div class="acciones-cell">
                      <!-- Botón para Editar -->
                      <button mat-icon-button (click)="configuracion(element)"
                      *ngIf=" (authService.hasPermission('analytics','read'))"
                      matTooltip="Ver configuración"
                      >
                        <mat-icon  >description</mat-icon>
                      </button>
                      <!-- Botón para Historico -->
                      <button mat-icon-button (click)="historialConfiguracion(element)"
                      *ngIf=" (authService.hasPermission('analytics','read'))"
                      matTooltip="Ver historial"
                      >
                        <mat-icon  >history</mat-icon>
                      </button>
                    </div>
                  </td>
                </ng-container>

                <!-- Acciones -->
                <ng-container matColumnDef="acciones">
                  <th mat-header-cell *matHeaderCellDef>Acciones</th>
                  <td mat-cell *matCellDef="let element">
                    <div class="evidencia-cell">
                      <!-- Botón para Editar -->
                      <button
                        mat-icon-button
                        (click)="agregarEditarAnaliticas(element)"
                        [disabled]="element.fecha_baja"
                        *ngIf=" (authService.hasPermission('analytics','edit'))"
                        matTooltip="Editar analítica"
                      >
                        <mat-icon
                          [ngClass]="{ 'editar-icono': !element.fecha_baja }"
                          >edit</mat-icon
                        >
                      </button>
                      <!-- Botón para Eliminar -->
                      <button
                        mat-icon-button
                        (click)="eliminarAnalitica(element)"
                        [disabled]="element.fecha_baja"
                        *ngIf="(authService.hasPermission('analytics','edit'))"
                        matTooltip="Deshabilitar analítica"
                      >
                        <mat-icon
                          [ngClass]="{ 'eliminar-icono': !element.fecha_baja }"
                          >delete</mat-icon
                        >
                      </button>
                    </div>
                  </td>
                </ng-container>

                <tr
                  mat-header-row
                  *matHeaderRowDef="displayedColumnsAnaliticas"
                  class="table-header"
                ></tr>
                <tr
                  mat-row
                  *matRowDef="let row; columns: displayedColumnsAnaliticas"
                ></tr>
              </table>
            </div>
            <mat-paginator
              #paginatorAnaliticas
              [pageSizeOptions]="[10, 20]"
              showFirstLastButtons
              class="table-paginator"
            ></mat-paginator>
          </div>
        </mat-card>
      </div>
    </div>
  </mat-tab>
  <mat-tab label="Logs analíticas">
    <div class="logsanaliticas-contenedor">
      <div class="logsanaliticas-contenedor-filtro">
        <mat-card class="mat-card-custom mat-elevation-z4">
          <div class="filtro-header">
            <span class="filtro-texto">
              <strong>Filtro de analíticas:</strong>
              {{ range.start | date : "dd/MM/yyyy HH:mm:ss" }} -
              {{ range.end | date : "dd/MM/yyyy HH:mm:ss" }} | Analítica:
              {{ selectedAnalitica.nombre }}
            </span>
            <div class="filtro-botones">
              <mat-spinner *ngIf="cargando"></mat-spinner>
              <button mat-icon-button (click)="recargar()" matTooltip="Recargar logs">
                <mat-icon>refresh</mat-icon>
              </button>
              <button mat-icon-button (click)="filtrarAnaliticas()" matTooltip="Aplicar filtro">
                <mat-icon class="agregar-icono">filter_list</mat-icon>
              </button>
            </div>
          </div>
        </mat-card>
      </div>
      <div class="logsanaliticas-contenedor-tabla">
        <mat-card class="mat-card-custom mat-elevation-z4">
          <div class="logsanaliticas-contenedor-element">
            <div class="table-wrapper">
              <table
                mat-table
                [dataSource]="dataSourceLogsAnaliticas"
                matSort
                class="table"
              >
                <!-- Nombre -->
                <ng-container matColumnDef="nombre">
                  <th mat-header-cell *matHeaderCellDef>Nombre</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.nombre_analitica }}
                  </td>
                </ng-container>

                <!-- Numero Serie -->
                <ng-container matColumnDef="numero_serie">
                  <th mat-header-cell *matHeaderCellDef>Dispositivo</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.numero_serie }}
                  </td>
                </ng-container>

                <!-- Observacion -->
                <ng-container matColumnDef="observacion">
                  <th mat-header-cell *matHeaderCellDef>Observación</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.observacion }}
                  </td>
                </ng-container>

                <!-- Desde -->
                <ng-container matColumnDef="desde">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Desde</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.desde | date : "dd/MM/yyyy HH:mm:ss" }}
                  </td>
                </ng-container>

                <!-- Hasta -->
                <ng-container matColumnDef="hasta">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Hasta</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.hasta | date : "dd/MM/yyyy HH:mm:ss" }}
                  </td>
                </ng-container>

                <!-- Fecha -->
                <ng-container matColumnDef="fecha">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha servidor</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.fecha | date : "dd/MM/yyyy HH:mm:ss" }}
                  </td>
                </ng-container>

                <tr
                  mat-header-row
                  *matHeaderRowDef="displayedColumnsLogsAnaliticas"
                  class="table-header"
                ></tr>
                <tr
                  mat-row
                  *matRowDef="let row; columns: displayedColumnsLogsAnaliticas"
                ></tr>
              </table>
            </div>
            <mat-paginator
              #paginatorLogsAnaliticas
              [pageSizeOptions]="[10, 20]"
              showFirstLastButtons
              class="table-paginator"
            ></mat-paginator>
          </div>
        </mat-card>
      </div>
    </div>
  </mat-tab>
</mat-tab-group>
