<h2 class="titulo-pagina">Dispositivos</h2>
<mat-tab-group
  mat-stretch-tabs="false"
  mat-align-tabs="center"
  [selectedIndex]="selectedPage.value"
  (selectedIndexChange)="selectPage($event)"
>
  <mat-tab label="Dispositivos">
    <div class="dispositivos-contenedor">
      <div class="dispositivos-contenedor-filtro">
        <mat-card class="mat-card-custom mat-elevation-z4">
          <div class="filtro-header">
            <span class="filtro-texto">
              <strong>Filtro de estados:</strong>
              <!-- Checkbox Activos/Inactivos -->
              <mat-checkbox
                class="example-margin"
                (change)="toggleChecked('activos')"
                [checked]="isSelected('activos')"
              >
                Habilitados</mat-checkbox
              >
              <mat-checkbox
                class="example-margin"
                (change)="toggleChecked('inactivos')"
                [checked]="isSelected('inactivos')"
                >Deshabilitados</mat-checkbox
              >
            </span>
            <div class="filtro-botones">
              <mat-spinner *ngIf="cargando"></mat-spinner>
              <button mat-icon-button (click)="recargar()" matTooltip="Recargar dispositivos">
                <mat-icon>refresh</mat-icon>
              </button>
              <button mat-icon-button (click)="agregarEditarDispositivo()"
              *ngIf=" (authService.hasPermission('models','read') && authService.hasPermission('devices','write'))"
              matTooltip="Agregar dispositivos"
              >
                <mat-icon class="agregar-icono">add_circle</mat-icon>
              </button>
            </div>
          </div>
        </mat-card>
      </div>
      <div class="dispositivos-contenedor-tabla">
        <mat-card class="mat-card-custom mat-elevation-z4">
          <div class="dispositivos-contenedor-element">
            <div class="table-wrapper">
              <table mat-table [dataSource]="dataSourceDevices" class="table">
                <!-- Codigo -->
                <ng-container matColumnDef="numeroserie">
                  <th mat-header-cell *matHeaderCellDef>Numero Serie</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.numero_serie }}
                  </td>
                </ng-container>

                <!-- registration -->
                <ng-container matColumnDef="registro">
                  <th mat-header-cell *matHeaderCellDef>Registro</th>
                  <td mat-cell *matCellDef="let element">
                    {{
                      element.registration_date | date : "dd/MM/yyyy HH:mm:ss"
                    }}
                  </td>
                </ng-container>

                <!-- lowdate -->
                <ng-container matColumnDef="lowdate">
                  <th mat-header-cell *matHeaderCellDef>Fecha de Baja</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.low_date | date : "dd/MM/yyyy HH:mm:ss" }}
                  </td>
                </ng-container>

                <!-- type -->
                <ng-container matColumnDef="tipo">
                  <th mat-header-cell *matHeaderCellDef>Tipo dispositivo</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.type_model }}
                  </td>
                </ng-container>

                <!-- servicio -->
                <ng-container matColumnDef="servicio">
                  <th mat-header-cell *matHeaderCellDef>Servicio</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.code_service }}
                  </td>
                </ng-container>

                <!-- manifiesto -->
                <ng-container matColumnDef="manifiesto">
                  <th mat-header-cell *matHeaderCellDef>
                    <div class="acciones-cell">
                      Manifiesto
                    </div>
                  </th>
                  <td mat-cell *matCellDef="let element">
                    <div class="acciones-cell">
                      <!-- Botón para Editar -->
                      <button mat-icon-button (click)="manifiesto(element)" [disabled]="element.low_date"
                      *ngIf=" (authService.hasPermission('devices','read'))"
                      matTooltip="Ver configuración"
                      >
                        <mat-icon  >description</mat-icon>
                      </button>
                    </div>
                  </td>
                </ng-container>

                <!-- Acciones -->
                <ng-container matColumnDef="acciones">
                  <th mat-header-cell *matHeaderCellDef>Acciones</th>
                  <td mat-cell *matCellDef="let element">
                    <div class="evidencia-cell">
                      <!-- Botón para Editar -->
                      <button
                        mat-icon-button
                        (click)="agregarEditarDispositivo(element)" [disabled]="element.low_date"
                        *ngIf=" (authService.hasPermission('models','read') && authService.hasPermission('devices','edit'))"
                        matTooltip="Editar dispositivo"
                        >
                        <mat-icon [ngClass]="{'editar-icono': !element.low_date}">edit</mat-icon>
                      </button>

                      <!-- Botón para Eliminar -->
                      <button
                        mat-icon-button
                        (click)="eliminarDispositivo(element)" [disabled]="element.low_date"
                         *ngIf=" (authService.hasPermission('devices','edit'))"
                         matTooltip="Deshabilitar dispositivo"
                        >
                        <mat-icon [ngClass]="{'eliminar-icono': !element.low_date}">delete</mat-icon>
                      </button>
                    </div>
                  </td>
                </ng-container>

                <tr
                  mat-header-row
                  *matHeaderRowDef="displayedColumnsData"
                  class="table-header"
                ></tr>
                <tr
                  mat-row
                  *matRowDef="let row; columns: displayedColumnsData"
                ></tr>
              </table>
            </div>
            <mat-paginator
              #paginatorData
              [pageSizeOptions]="[10, 20]"
              showFirstLastButtons
              class="table-paginator"
            ></mat-paginator>
          </div>
        </mat-card>
      </div>
      <div class="contenedor-tipos-code">
        <!-- Dispositivos -->
        <div class="dispositivos-contenedor-tabla-tipos">
          <mat-card class="mat-card-custom mat-elevation-z4">
            <div class="dispositivos-contenedor-element">
              <div class="table-wrapper">
                <table mat-table [dataSource]="dataSourceTipo" class="table">
                  <!-- type -->
                  <ng-container matColumnDef="tipo">
                    <th mat-header-cell *matHeaderCellDef>Tipo dispositivo</th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.nombre }}
                    </td>
                  </ng-container>

                  <!-- template -->
                  <ng-container matColumnDef="template">
                    <th mat-header-cell *matHeaderCellDef>
                      <div class="acciones-cell">
                        Template
                      </div>
                    </th>
                    <td mat-cell *matCellDef="let element">
                      <div class="acciones-cell">
                        <!-- Botón para Editar -->
                        <button mat-icon-button (click)="template(element)"
                        *ngIf=" (authService.hasPermission('models','read'))"
                        matTooltip="Configurar template"
                        >
                          <mat-icon >description</mat-icon>
                        </button>
                      </div>
                    </td>
                  </ng-container>

                  <!-- Acciones -->
                  <ng-container matColumnDef="acciones">
                    <th mat-header-cell *matHeaderCellDef>
                      <div class="acciones-cell">
                        Acción
                        <button mat-icon-button (click)="agregarTipo()"
                        *ngIf=" (authService.hasPermission('models','write'))"
                        matTooltip="Agregar tipo de dispositivo"
                        >
                          <mat-icon class="agregar-icono">add_circle</mat-icon>
                        </button>
                      </div>
                    </th>
                    <td mat-cell *matCellDef="let element">
                      <div class="acciones-cell">
                        <!-- Botón para Eliminar -->
                        <button mat-icon-button (click)="eliminarTipo(element)"
                        *ngIf=" (authService.hasPermission('models','edit'))"
                        matTooltip="Eliminar tipo de dispositivo"
                        >
                          <mat-icon class="eliminar-icono">delete</mat-icon>
                        </button>
                      </div>
                    </td>
                  </ng-container>

                  <tr
                    mat-header-row
                    *matHeaderRowDef="displayedColumnsTipo"
                    class="table-header"
                  ></tr>
                  <tr
                    mat-row
                    *matRowDef="let row; columns: displayedColumnsTipo"
                  ></tr>
                </table>
              </div>
              <mat-paginator
                #paginatorTipo
                [hidePageSize]="true"
                [pageSizeOptions]="[20]"
                showFirstLastButtons
                class="table-paginator"
              ></mat-paginator>
            </div>
          </mat-card>
        </div>
        <!-- Servicios -->
        <div class="dispositivos-contenedor-tabla-tipos">
          <mat-card class="mat-card-custom mat-elevation-z4">
            <div class="dispositivos-contenedor-element">
              <div class="table-wrapper">
                <table mat-table [dataSource]="dataSourceServicio" class="table">
                  <!-- type -->
                  <ng-container matColumnDef="servicio">
                    <th mat-header-cell *matHeaderCellDef>Servicio</th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.nombre }}
                    </td>
                  </ng-container>

                  <!-- Acciones -->
                  <ng-container matColumnDef="acciones">
                    <th mat-header-cell *matHeaderCellDef>
                      <div class="acciones-cell">
                        Acción
                        <button mat-icon-button (click)="agregarServicio()"
                        *ngIf=" (authService.hasPermission('servicecodes','write'))"
                        matTooltip="Agregar servicio"
                        >
                          <mat-icon class="agregar-icono">add_circle</mat-icon>
                        </button>
                      </div>
                    </th>
                    <td mat-cell *matCellDef="let element">
                      <div class="acciones-cell">
                        <!-- Botón para Eliminar -->
                        <button mat-icon-button (click)="eliminarServicio(element)"
                        *ngIf=" (authService.hasPermission('servicecodes','edit'))"
                        matTooltip="Eliminar servicio"
                        >
                          <mat-icon class="eliminar-icono">delete</mat-icon>
                        </button>
                      </div>
                    </td>
                  </ng-container>

                  <tr
                    mat-header-row
                    *matHeaderRowDef="displayedColumnsServicio"
                    class="table-header"
                  ></tr>
                  <tr
                    mat-row
                    *matRowDef="let row; columns: displayedColumnsServicio"
                  ></tr>
                </table>
              </div>
              <mat-paginator
                #paginatorServicio
                [hidePageSize]="true"
                [pageSizeOptions]="[20]"
                showFirstLastButtons
                class="table-paginator"
              ></mat-paginator>
            </div>
          </mat-card>
        </div>
      </div>

    </div>
  </mat-tab>
  <mat-tab label="Dispositivos - Analiticas">
    <div class="dispositivosanaliticas-contenedor">
      <div class="dispositivosanaliticas-contenedor-filtro">
        <mat-card class="mat-card-custom mat-elevation-z4">
          <div class="filtro-header">
            <span class="filtro-texto">
              <strong>Estados de vínculos:</strong>
              <!-- Checkbox Activos/Inactivos -->
              <mat-checkbox
                class="example-margin"
                (change)="toggleChecked('activos')"
                [checked]="isSelected('activos')"
              >
                Habilitados</mat-checkbox
              >
              <mat-checkbox
                class="example-margin"
                (change)="toggleChecked('inactivos')"
                [checked]="isSelected('inactivos')"
                >Deshabilitados</mat-checkbox
              >
            </span>
            <div class="filtro-botones">
              <mat-spinner *ngIf="cargando"></mat-spinner>
              <button mat-icon-button (click)="recargar()" matTooltip="Recargar vínculos">
                <mat-icon>refresh</mat-icon>
              </button>
              <button mat-icon-button (click)="agregarVinculo()"
              *ngIf="(authService.hasPermission('devices','read') && authService.hasPermission('analytics','read') && authService.hasPermission('devices','write') )"
              matTooltip="Editar vínculo"
              >
                <mat-icon class="agregar-icono">add_link</mat-icon>
              </button>
            </div>
          </div>
        </mat-card>
      </div>
      <div class="dispositivosanaliticas-contenedor-tabla">
        <mat-card class="mat-card-custom mat-elevation-z4">
          <div class="dispositivosanaliticas-contenedor-element">
            <div class="table-wrapper">
              <table
                mat-table
                [dataSource]="dataSourceDipositivosAnalitica"
                class="table"
              >
                <!-- Numero de serie -->
                <ng-container matColumnDef="numero_serie">
                  <th mat-header-cell *matHeaderCellDef>Dispositivo</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.numero_serie }}
                  </td>
                </ng-container>

                <!-- nombre analitica -->
                <ng-container matColumnDef="analitica">
                  <th mat-header-cell *matHeaderCellDef>Analítica</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.nombre_analitca }}
                  </td>
                </ng-container>

                <!-- Fecha Alta -->
                <ng-container matColumnDef="fecha_alta">
                  <th mat-header-cell *matHeaderCellDef>Vinculación</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.registration | date : "dd/MM/yyyy HH:mm:ss" }}
                  </td>
                </ng-container>

                <!-- Fecha Baja -->
                <ng-container matColumnDef="fecha_baja">
                  <th mat-header-cell *matHeaderCellDef>Desvinculación</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.low_date | date : "dd/MM/yyyy HH:mm:ss" }}
                  </td>
                </ng-container>

                <!-- Acciones -->
                <ng-container matColumnDef="acciones">
                  <th mat-header-cell *matHeaderCellDef>Acciones</th>
                  <td mat-cell *matCellDef="let element">
                    <div class="acciones-cell">
                      <!-- Botón para Eliminar -->
                      <button
                        mat-icon-button
                        (click)="eliminarVinculo(element)"
                        [disabled]="element.low_date"
                        *ngIf="(authService.hasPermission('devices','edit'))"
                        matTooltip="Deshabilitar vínculo"
                        >
                        <mat-icon
                          [ngClass]="{ 'eliminar-icono': !element.low_date }"
                          >link_off</mat-icon
                        >
                      </button>
                    </div>
                  </td>
                </ng-container>

                <tr
                  mat-header-row
                  *matHeaderRowDef="displayedColumnsDispositivosAnaliticas"
                  class="table-header"
                ></tr>
                <tr
                  mat-row
                  *matRowDef="
                    let row;
                    columns: displayedColumnsDispositivosAnaliticas
                  "
                ></tr>
              </table>
            </div>
            <mat-paginator
              #paginatorDispositivoAnalitica
              [pageSizeOptions]="[10, 20]"
              showFirstLastButtons
              class="table-paginator"
            ></mat-paginator>
          </div>
        </mat-card>
      </div>
    </div>
  </mat-tab>
</mat-tab-group>
