<h2 class="titulo-pagina">Endpoints</h2>
<div class="endpoints-contenedor">
  <div class="endpoints-contenedor-filtro">
    <mat-card class="mat-card-custom mat-elevation-z4">
      <div class="filtro-header">
        <span class="filtro-texto">
          <strong>Gestión de endpoints</strong>
        </span>
        <div class="filtro-botones">
          <mat-spinner *ngIf="cargando"></mat-spinner>
          <button mat-icon-button (click)="recargar()" matTooltip="Recargar endpoints">
            <mat-icon>refresh</mat-icon>
          </button>
          <button mat-icon-button (click)="agregarEditarEndpoint()"
           *ngIf=" (authService.hasPermission('endpoints','write') && authService.hasPermission('variables','read') && authService.hasPermission('servicecompany','read') && authService.hasPermission('servicecodes','read'))"
            matTooltip="Agreagr endpoint"
           >
            <mat-icon class="agregar-icono">add_circle</mat-icon>
          </button>
        </div>
      </div>
    </mat-card>
  </div>

  <!-- Endpoints -->
  <div class="endpoints-contenedor-tabla">
    <mat-card class="mat-card-custom mat-elevation-z4">
      <div class="endpoints-contenedor-element">
        <div class="table-wrapper">
          <table mat-table [dataSource]="dataSourceEndpoints" class="table">
            <ng-container matColumnDef="nombre">
              <th mat-header-cell *matHeaderCellDef>Nombre</th>
              <td mat-cell *matCellDef="let element">{{ element.nombre }}</td>
            </ng-container>

            <ng-container matColumnDef="servicio">
              <th mat-header-cell *matHeaderCellDef>Serivicio</th>
              <td mat-cell *matCellDef="let element">{{ element.servicio }}</td>
            </ng-container>

            <ng-container matColumnDef="compania">
              <th mat-header-cell *matHeaderCellDef>Compañía</th>
              <td mat-cell *matCellDef="let element">{{ element.id_compa }}</td>
            </ng-container>

            <ng-container matColumnDef="urllogin">
              <th mat-header-cell *matHeaderCellDef>Login</th>
              <td mat-cell *matCellDef="let element">{{ element.urllogin }}</td>
            </ng-container>

            <ng-container matColumnDef="urldata">
              <th mat-header-cell *matHeaderCellDef>Data</th>
              <td mat-cell *matCellDef="let element">{{ element.urldata }}</td>
            </ng-container>

            <ng-container matColumnDef="usuario">
              <th mat-header-cell *matHeaderCellDef>Usuario</th>
              <td mat-cell *matCellDef="let element">{{ element.usuario }}</td>
            </ng-container>

            <ng-container matColumnDef="contrasenea">
              <th mat-header-cell *matHeaderCellDef>Contraseña</th>
              <td mat-cell *matCellDef="let element">{{ element.contrasenea }}</td>
            </ng-container>

            <ng-container matColumnDef="acciones">
              <th mat-header-cell *matHeaderCellDef>Acciones</th>
              <td mat-cell *matCellDef="let element">
                <button
                  mat-icon-button
                  (click)="ejecutarEndpoint(element)"
                  [disabled]="element.low_date"
                  *ngIf=" (authService.hasPermission('endpoints','read'))"
                  matTooltip="Ejecutar manual"
                  >
                  <mat-icon [ngClass]="{ 'ver-icono': !element.low_date }"
                    >play_arrow</mat-icon
                  >
                </button>
                 <button
                  mat-icon-button
                  (click)="verVariables(element)"
                  [disabled]="element.low_date"
                  *ngIf=" (authService.hasPermission('endpoints','read') && authService.hasPermission('variables','read'))"
                  matTooltip="Ver  variables"
                  >
                  <mat-icon [ngClass]="{ 'ver-icono': !element.low_date }"
                    >visibility</mat-icon
                  >
                </button>
                <button
                  mat-icon-button
                  (click)="agregarEditarEndpoint(element)"
                  [disabled]="element.low_date"
                  *ngIf=" (authService.hasPermission('endpoints','edit') &&authService.hasPermission('variable','read'))"
                  matTooltip="Editar endpoint"
                  >
                  <mat-icon [ngClass]="{ 'editar-icono': !element.low_date }"
                    >edit</mat-icon
                  >
                </button>
                <button
                  mat-icon-button
                  (click)="eliminarEndpoint(element)"
                  [disabled]="element.low_date"
                  *ngIf=" (authService.hasPermission('endpoints','edit'))"
                  matTooltip="Eliminar endpoint"
                  >
                  <mat-icon [ngClass]="{ 'eliminar-icono': !element.low_date }"
                    >delete</mat-icon
                  >
                </button>
              </td>
            </ng-container>
            <tr
              mat-header-row
              *matHeaderRowDef="displayedColumnsEndpoints"
              class="table-header"
            ></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: displayedColumnsEndpoints"
            ></tr>
          </table>
        </div>
        <mat-paginator
          #paginatorEndpoints
          [pageSizeOptions]="[10, 20]"
          showFirstLastButtons
          class="table-paginator"
        ></mat-paginator>
      </div>
    </mat-card>
  </div>

  <div class="contenedor-compania-variables">
  <!-- Compañia -->
  <div class="contenedor-tabla-compania-variable">
    <mat-card class="mat-card-custom mat-elevation-z4">
      <div class="endpoints-contenedor-element">
        <div class="table-wrapper">
          <table mat-table [dataSource]="dataSourceCompania" class="table">
            <!-- empresa -->
            <ng-container matColumnDef="empresa">
              <th mat-header-cell *matHeaderCellDef>Empresa</th>
              <td mat-cell *matCellDef="let element">
                {{ element.empresa }}
              </td>
            </ng-container>

            <!-- servicio -->
            <ng-container matColumnDef="servicio">
              <th mat-header-cell *matHeaderCellDef>Servicio</th>
              <td mat-cell *matCellDef="let element">
                {{ element.servicio }}
              </td>
            </ng-container>

            <!-- intervalo -->
            <ng-container matColumnDef="intervalo">
              <th mat-header-cell *matHeaderCellDef>Intervalo</th>
              <td mat-cell *matCellDef="let element">
                {{ element.intervalo }}
              </td>
            </ng-container>

            <!-- Acciones -->
            <ng-container matColumnDef="acciones">
              <th mat-header-cell *matHeaderCellDef>
                <div class="acciones-cell">
                  Acción
                  <button mat-icon-button (click)="agregarCompania()"
                   *ngIf=" (authService.hasPermission('servicecompany','write'))"
                     matTooltip="Agregar compañía"
                  >
                    <mat-icon class="agregar-icono">add_circle</mat-icon>
                  </button>
                </div>
              </th>
              <td mat-cell *matCellDef="let element">
                <div class="acciones-cell">
                  <!-- Botón para Eliminar -->
                  <button mat-icon-button (click)="eliminarCompania(element)"
                   *ngIf=" (authService.hasPermission('servicecompany','edit'))"
                    matTooltip="Eliminar compañía"
                  >
                    <mat-icon class="eliminar-icono">delete</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>
            <tr
              mat-header-row
              *matHeaderRowDef="displayedColumnsCompania"
              class="table-header"
            ></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: displayedColumnsCompania"
            ></tr>
          </table>
        </div>
        <mat-paginator
          #paginatorCompania
          [hidePageSize]="true"
          [pageSizeOptions]="[20]"
          showFirstLastButtons
          class="table-paginator"
        ></mat-paginator>
      </div>
    </mat-card>
  </div>

  <!-- variables -->
  <div class="contenedor-tabla-compania-variable">
    <mat-card class="mat-card-custom mat-elevation-z4">
      <div class="endpoints-contenedor-element">
        <div class="table-wrapper">
          <table mat-table [dataSource]="dataSourceVariables" class="table">
            <!-- nombre -->
            <ng-container matColumnDef="nombre">
              <th mat-header-cell *matHeaderCellDef>Nombre</th>
              <td mat-cell *matCellDef="let element">
                {{ element.nombre }}
              </td>
            </ng-container>

            <!-- codigo -->
            <ng-container matColumnDef="codigo">
              <th mat-header-cell *matHeaderCellDef>Código</th>
              <td mat-cell *matCellDef="let element">
                {{ element.codigo }}
              </td>
            </ng-container>

            <!-- GPS -->
            <ng-container matColumnDef="gps">
              <th mat-header-cell *matHeaderCellDef>GPS</th>
              <td mat-cell *matCellDef="let element">
                {{ element.gps }}
              </td>
            </ng-container>

            <!-- operarios -->
            <ng-container matColumnDef="operarios">
              <th mat-header-cell *matHeaderCellDef>Operarios</th>
              <td mat-cell *matCellDef="let element">
                {{ element.operarios }}
              </td>
            </ng-container>

            <!-- Acciones -->
            <ng-container matColumnDef="acciones">
              <th mat-header-cell *matHeaderCellDef>
                <div class="acciones-cell">
                  Acción
                  <button mat-icon-button (click)="agregarEditarVariables()"
                   *ngIf=" (authService.hasPermission('variables','write'))"
                     matTooltip="Agregar variable"
                  >
                    <mat-icon class="agregar-icono">add_circle</mat-icon>
                  </button>
                </div>
              </th>
              <td mat-cell *matCellDef="let element">
                <div class="acciones-cell">
                  <!-- Botón para Eliminar -->
                  <button mat-icon-button (click)="agregarEditarVariables(element)"
                   *ngIf=" (authService.hasPermission('variables','edit'))"
                    matTooltip="Editar variable"
                  >
                    <mat-icon class="editar-icono">edit</mat-icon>
                  </button>
                </div>
                <div class="acciones-cell">
                  <!-- Botón para Eliminar -->
                  <button mat-icon-button (click)="eliminarVariable(element)"
                   *ngIf=" (authService.hasPermission('variables','edit'))"
                    matTooltip="Eliminar variable"
                  >
                    <mat-icon class="eliminar-icono">delete</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>
            <tr
              mat-header-row
              *matHeaderRowDef="displayedColumnsVariable"
              class="table-header"
            ></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: displayedColumnsVariable"
            ></tr>
          </table>
        </div>
        <mat-paginator
          #paginatorVariable
          [hidePageSize]="true"
          [pageSizeOptions]="[20]"
          showFirstLastButtons
          class="table-paginator"
        ></mat-paginator>
      </div>
    </mat-card>
  </div>
  </div>
</div>

